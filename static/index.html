<!doctype HTML>
<html>
<head>
    <title>Auto Chess</title>

    <script src="/js/socket.io.js"></script>

    <style>
        html, body {
            font-size: 10px;
        }

        /* General */
        .title {
            width: 100%;
            font-size: 4rem;
            text-align: center;
        }

        .section {
            width: 49%;
            margin-top: 2rem;
            margin-bottom: 2rem;
            display: inline-block;
        }

        .section-title {
            width: 100%;
            font-size: 3rem;
            text-align: center;
            text-decoration: underline;
        }

        /* Game Connect */
        #game-connect {
            max-width: 40rem;
            margin: auto;
            margin-top: 2rem;
            font-size: 2rem;
            text-align: center;
        }

        #short-code-input-box {
            height: 8.5rem;
            margin-top: 5rem;
            text-align: center;
        }

        #short-code-input-box div, input {
            width: 45%;
            display: inline-block;
            text-align: center;
        }

        #short-code-input-label {
            float: left;
        }

        #short-code-input {
            width: 10rem;
            height: 4rem;
            line-height: 4rem;
            margin-top: 1.5rem;
            float: right;
            font-size: 2.5rem;
        }

        #connect-button {
            width: 12rem;
            margin-top: 1rem;
            padding: 1rem;
            display: inline-block;
            border: 1px solid black;
            cursor: pointer;
            background-color: white;
            text-align: center;
            user-select: none;
        }

        #connect-button:active {
            font-weight: bold;
        }

        #connect-status {
            margin-top: 4rem;
        }

        #connect-status.error {
            color: #D50000;
        }

        /* Timer */
        .timer {
            width: 100%;
            margin-top: 20px;
            font-size: 6rem;
            text-align: center;
        }

        /* Moves List */
        .moves-table {
            width: 100%;
            margin-top: 2rem;
        }

        .moves-table th {
            width: 50%;
            font-size: 3rem;
            text-align: center;
        }

        .moves-table th:nth-child(1) {
            width: 20%;
        }

        .moves-table td {
            border: 1px solid black;
        }
    </style>
</head>
<body>
<div class="title">Auto Chess</div>
<div id="game-connect">
    <div class="section-title">Connect</div>

    <form onsubmit="return onConnectButtonClick();">
        <div id="short-code-input-box">
            <div id="short-code-input-label">Please enter your Chess Board's 4 digit code</div>
            <input id="short-code-input" pattern=".{4}" required title="4 characters" type="text">
        </div>

        <button id="connect-button">Connect</button>
        <div id="connect-status"></div>
    </form>
</div>

<div id="game-info" style="display: none">
    <div id="timers">
        <div class="section timer-container">
            <div class="section-title">Player</div>
            <div class="timer" id="player-timer">5:00</div>
        </div>
        <div class="section timer-container">
            <div class="section-title">Opponent</div>
            <div class="timer" id="opponent-timer">5:00</div>
        </div>
    </div>

    <div id="moves">
        <div class="section moves-container">
            <div class="section-title">Player</div>
            <table class="moves-table" id="player-moves">
                <tr>
                    <th>#</th>
                    <th>Move</th>
                </tr>
            </table>
        </div>
        <div class="section moves-container">
            <div class="section-title">Opponent</div>
            <table class="moves-table" id="opponent-moves">
                <tr>
                    <th>#</th>
                    <th>Move</th>
                </tr>
            </table>
        </div>
    </div>
</div>

<script>
    /**
     * Make a number 2 digits
     * @param num Number to make 2 digits
     * @returns 2 digit form of number
     */
    function makeTwoDigits(num) {
        return ("0" + num).slice(-2);
    }

    /**
     * Timer class
     * @param id Id of HTML element to show timer duration in
     * @param duration Starting duration in MS
     * @constructor
     */
    function Timer(id, duration) {
        var self = this;
        self.id = id;
        self.start = Date.now();
        self.duration = duration;
        self.el = document.getElementById(self.id);

        if (self.el === null) {
            console.error("Could not find element with id: \"" + self.id + "\"");
        }

        self.tick = function() {
            // Calculate
            var dt = Date.now() - self.start;
            var ms = self.duration - dt;

            var date = new Date(0, 0, 0, 0, 0, 0, ms);

            // Display
            if (ms <= 0) {
                self.el.innerText = "0:00";
                clearInterval(self.interval);
            } else {
                self.el.innerText = date.getMinutes() + ":" + makeTwoDigits(date.getSeconds());
            }
        };

        self.interval = setInterval(self.tick, 1000);
    }

    // Connect button
    var shortCodeInput = document.getElementById("short-code-input");
    var connectStatus = document.getElementById("connect-status");

    function Socket(chess_board_id) {
        var self = this;
        self.chess_board_id = chess_board_id;
        self.socket = undefined;

        /**
         * Connect to server socket
         * @throws Error if already connected to socket
         */
        self.connect = function() {
            if (self.socket !== undefined) {
                throw Error("Already connected to socket");
            }

            self.socket = io("/");
            self.socket.on("connect", self.onConnect);
        };

        /**
         * Determine if instance is connected to server via a socket
         * @returns bool True if connected, false if not
         */
        self.connected = function() {
            return self.socket === undefined;
        };

        /**
         * Handler to be run when socket connects to server
         */
        self.onConnect = function() {
            console.log("onConnect");
        };
    }

    function onConnectButtonClick() {
        if (socket !== undefined) {
            connectStatus.innerText = "Already connected";
            connectStatus.classList.add("error");
        } else {
            socket = io("/" + shortCodeInput.value);
            socket.on("connection", )
        }

        return false;
    }



    // Create timers
    var fiveMinutes = 1000 * 60 * 5;
    var pTimer = new Timer("player-timer", fiveMinutes);
    var oTimer = new Timer("opponent-timer", fiveMinutes);
</script>
</body>
</html>